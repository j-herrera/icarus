<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>D3 World Map</title>
    <style>
        .x.axis line {
            shape-rendering: auto;
        }
        .y.axis line {
            shape-rendering: auto;
        }

        .line {
            fill: none;
            stroke: #000;
            stroke-width: 1.5px;
        }
    </style>
    <script src='http://d3js.org/d3.v3.min.js'></script>
  </head>
  <body>
    <script>
		var n = 10;
		var data = d3.range(0);
		var margin = {top: 30, right: 20, bottom: 30, left: 50},
    		width = 960 - margin.left - margin.right,
		    height = 600 - margin.top - margin.bottom;

		var x = d3.scale.linear()
			.domain([0, n - 1])
			.range([0, width]);
		var y = d3.scale.linear()
			.domain([-90, 90])
			.range([height, 0]);

		var yAxis = d3.svg.axis().scale(y).orient('right').ticks(5);

		var valueLine = d3.svg.line()
			.x(function(d, i) {return x(i);})
			.y(function(d, i) {return y(d);});

		var svg = d3.select('body')
			.append('svg')
				.attr('width', width + margin.left + margin.right)
				.attr('height', height + margin.top + margin.bottom)
				.style('margin-left', -margin.left + 'px')
			.append('g')
				.attr('transform',
					'translate(' + margin.left + ',' + margin.top + ')');

		random = d3.random.normal(0, .2);

		function initialiseData(data) {
			var latitude;
			d3.json('api/getISSData', function(error, json) {
				if (error) return console.warn(error);
				latitude = json.latitude;
				
				data.push(latitude);

				svg.append('path')
					.attr('class', 'line')
					.attr('d', valueLine(data));

				svg.append('g')
					.attr('class', 'y axis')
					.call(yAxis);
			});
		}

		initialiseData(data);


		function updateData(data) {
	        var latitude;
    	    d3.json('api/getISSData', function(error, json) {
    	        if (error) return console.warn(error);
    	        latitude = json.latitude;

				data.push(latitude);
				y.domain([d3.min(data), d3.max(data)]);
				var svg = d3.select('body');

				if (data.length > n - 1) {
					var path = svg.select('path');
					path.attr('d', valueLine(data))
						.attr('transform', null)
						.transition()
							.duration(0)
							.attr('transform', 'translate(' + x(-1) + ')');
					data.shift();
				} else {
					svg.select('.line')
						.attr('d', valueLine(data))
						.attr('transform', null);
				}
						
					svg.select('.y.axis')
						.transition()
						.duration(0)
						.call(yAxis);
			});
		}

		setInterval(function() {
			updateData(data);
		}, 2000);
					
		
		
    </script>
    </body>
</html>
